<!DOCTYPE html>
<!-- vim: set ts=4 et sw=4 sts=4 fileencoding=utf-8: -->
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Directory Tree</title>
    <link rel="stylesheet" type="text/css" href="css/treeview.css"/>
    <script type="text/javascript">
        console.log("loading script...");

        function use_service_worker() {
            var userAgent = navigator.userAgent.match(/(Firefox|Chrome)\/(\d+\.)/);
            if (userAgent) {
                var agent = userAgent[1];
                var version = parseInt(userAgent[2]);
            }
            if (
            if (('serviceWorker' in navigator) &&
                (!userAgent ||
                    (agent === 'Firefox' && version >= 46) ||
                    (agent === 'Chrome'  && version >= 50)
                )
            ) {
                return true;
            }
            else {
                return false;
            }
        }

        if (use_service_worker() == true) {
            navigator.serviceWorker.register(
		        './cache_manager.js',
                {
                    scope: '/'
                }
            ).then(function(reg) {
                // registration worked
                console.log('Registration succeeded. Scope is ' + reg.scope);
            }).catch(function(error) {
                // registration failed
                console.log('Registration failed with ' + error);
            });
        };

        function erase_cache_all () {
            caches.keys().then((cacheNames) => {
                cacheNames.map((cacheName) => {
                    console.log("Delete cache: " + cacheName);
                    caches.delete(cacheName);
                })
            })
        }
    </script>
    <script type="text/javascript" src="js/jquery-3.1.0.min.js"></script>
    <script type="text/javascript" src="js/marked.js"></script>
    <script type="text/javascript" src="js/website-maker.js"></script>
  </head>
  <body onload="main(document.URL)">
    <header>
      <nav>
        <h1>Navigation</h1>
    <div class="css-treeview insert-xml" insert-src="xml/files.xml" insert-xsl="xsl/listdir.xsl" />
      </nav>
    </header>
    <main>
      <article>
        <div class="container">
          <div class="markdown_content insert-md" insert-src="${file:=readme.md}" />
        </div>
      </article>
    </main>
    <form name="development">
        <input type="button" name="clear" value="clear" onClick="erase_cache_all()">
    </form>
  </body>
</html>
